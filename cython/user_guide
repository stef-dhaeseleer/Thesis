TODO: add information on how to 'prepare the SD card', how to generate the key files, how to process the results on board.


PREPARING THE SD CARDS

%%%% complete example root folders for both reduced and full DES can be found in the files %%%%

Give the structure of the files (see other file).

Give information on Python scripts to make the key files.
The des_keygen.py can be used to generate the key.txt file needed for the S card.

For zero correlation experiment:

	Put a file containing the 16 round keys (each on a new line, round 1 to 16 respectively) 
	to be used in "testfiles/zero_corr/key_used.txt"

	Run 'python des_keygen.py zero_corr' in the terminal

	The needed key file can be found in "testfiles/zero_corr/key.txt"


For reduced round DES Matsui experiment:

	run 'python des_keygen.py reduced_round' in the terminal

	Follow the instruction that are printed on screen to verify that no duplicate keys have
	been randomly generated. Delete the "testfiles/reduced_round/new_key_vals.txt" file in order
	to reset the keys used in the search for duplicate keys.

	The needed key file (randomly generated keys) can be found in "testfiles/reduced_round/key.txt"
	
NOTE:   the key changing functionality for the reduced round DES experiments is also included in bash
        scripts. Run 'new_key' to generate the new key file and have it copied to the appropriate place.


Give information on the 2 partitions of the SD card and what should be put on which one.

The SD cards contains 2 partitions.

A smaller partition (less than one GB): containing the BOOT.bin file and image.ub
	
	These files define the hardware used during the experiments. Two versions are provided.
	A version with 192 reduced round DES cores and a version with 128 full DES cores.

A bigger partition (more than 10 GB): containing the file system accessible during operation.

	The root in use during operation can be found at TODO.
	This is where the necessary files should be added before operation.

	The python folder files are dependent on whether the reduced round or full DES version is used.

	Example parameter files for the different types of experiments are also provided.

A list of the files that should be added to operate the platform:

reports folder: key.txt, param.txt

python folder: monitor.py, interface.py


HOW TO CONNECT TO DEVICE

After preparing the SD card and putting it in the FPGA, connect the FPGA via USB to
to the UART port.

Open a terminal window on the PC.
Turn on the FPGA (it will now begin booting)
For Linux device: use the 'make uart' command (found in the make file) to connect.
(TODO: add an explanation on how to connect via screen in general)

username: root
password: root

USING THE PLATFORM WHEN CONNECTED

Start location directory tree (/home):

root
|-- python
|	|
|	| monitor.py, interface.py
|
|-- reports
	|
	|   key.txt, param.txt, status.txt, seeds.txt, results.txt, TODO
	|
	| old_res
	|
	|   Storage place for old results

To set the parameters, edit (or create) the 'param.txt' file according to the template.

First cd to the python directory
	cd python

Then open Python and import the monitor file
	python
	import monitor

Now you can use all the functions form the monitor file to control the HW.

'monitor.help()' gives an overview of what all the functions do.

Normal workflow looks like this:
	
	monitor.init_platform()	
	monitor.performance_stats()

	monitor.get_hw_status()
	monitor.start_all(1)

	...
	
	monitor.get_hw_status()

	monitor.get_results_all()
	monitor.print_results()
	

Explanation:
init_platform(): Initializes the platform (creates the status and results file).
		 If the param.txt file is present, it will list the current parameters.
		 Else the user will be prompted to input the parameters.

performance_stats(): Prints the performance stats for the current setup. This way we 
		     know how long the run will take to complete once we start it.

get_hw_status(): Prints the status of the blocks (first to check if all are IDLE).

start_all(1): Starts all blocks with base seed 1 (seed increments for following blocks)

... : Let time pass for HW to finish (see performance stats for duration).

get_hw_status(): Prints the status of the blocks to check if all are DONE. 

get_results_all(): Collects the counter results from all blocks that are done and writes
		   them into the results file. The results are processed and the overall mean and
		   standard deviation of the bias over all samples are printed for the user to read

print_results(): Prints the results file to the terminal so the user can see the results.

After this, the cycle can be repeated if needed (new seeds, new masks, new keys...).


+ Add the explanation of the other functions here as well (TODO)


THE RESULTS

NOTE:   copying the result files to the 'old_res' folder can be done with a bash script. 
        Run 'mv_res x' to move them with '_x' attached behind their name.
        e.g. after firs experiment run 'mv_res 1', after second 'mv_res 2' ...


Three result files are always generated:

results.txt
    This file contains the raw counter results for all cores.
    The structure is as follows:
    POLYNOMIAL : SEED : COUNTER RESULT
    
    This header is printed on the first line, followed by the data for every core (in ascending order).
    Every core results begin on a new file.
    
bias_results.txt
    This file contains the processed bias result for every core.
    The structure is as follows:
    
    Polynomial      : xxxx
    Calculated bias : xxxx
    
    For every core (in ascending order) this is printed in the file.
    With a new line between each core.

bias_stats.txt
    This file contains the overall mean and standard deviation of the bias over all 192 samples.
    The structure is as follows:
    
    RESULTS FROM EXPERIMENT 

    Mean bias   : 7.49578381753e-05
    Mean log 2  : -13.7035611289

    STD         : 7.24604263276e-06
    STD  log 2  : -17.0743752753

    Samples : 192
    Encryptions per sample (log2) : 32.0
    Input mask used : 0x2104008000000000
    Output mask used : 0x21040080

    


